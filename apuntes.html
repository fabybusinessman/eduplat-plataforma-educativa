<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduPlat - Apuntes con Carpetas</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        :root {
            --primary-color: #4a90e2; --background-light: #f8f9fa;
            --background-white: #ffffff; --text-dark: #343a40;
            --text-light: #6c757d; --border-color: #dee2e6;
            --shadow: 0 4px 6px rgba(0,0,0,0.05); --border-radius: 12px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--background-light); display: flex; }

        .sidebar { width: 260px; background: white; height: 100vh; position: fixed; border-right: 1px solid var(--border-color); padding: 30px 20px; }
        .main-content { margin-left: 260px; width: calc(100% - 260px); padding: 30px; }
        
        /* Layout de Apuntes */
        .notes-container { display: grid; grid-template-columns: 250px 1fr; gap: 20px; margin-top: 20px; height: 75vh; }
        
        /* Sidebar de Carpetas */
        .folders-sidebar { background: white; border-radius: var(--border-radius); padding: 20px; box-shadow: var(--shadow); border: 1px solid var(--border-color); }
        .folder-item { padding: 12px; cursor: pointer; border-radius: 8px; margin-bottom: 8px; transition: 0.3s; color: var(--text-light); }
        .folder-item:hover { background: #f0f7ff; color: var(--primary-color); }
        .folder-item.active { background: var(--primary-color); color: white; font-weight: 600; }
        .btn-add-folder { width: 100%; padding: 10px; border: 1px dashed var(--primary-color); color: var(--primary-color); background: none; border-radius: 8px; cursor: pointer; margin-bottom: 15px; }

        /* Area del Editor */
        .editor-area { background: white; border-radius: var(--border-radius); padding: 25px; box-shadow: var(--shadow); border: 1px solid var(--border-color); display: flex; flex-direction: column; }
        #notes-text { flex-grow: 1; width: 100%; border: 1px solid #eee; border-radius: 8px; padding: 15px; font-family: inherit; font-size: 1rem; resize: none; outline: none; margin-bottom: 15px; }
        .editor-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .btn-save { background: var(--primary-color); color: white; border: none; padding: 10px 25px; border-radius: 8px; cursor: pointer; font-weight: 600; }

        .nav-link { text-decoration: none; color: var(--text-light); display: flex; padding: 12px; gap: 12px; border-radius: 8px; }
        .nav-link.active { background: #eef5ff; color: var(--primary-color); font-weight: 600; }

        @media (max-width: 768px) { .sidebar { display: none; } .main-content { margin-left: 0; width: 100%; } .notes-container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <aside class="sidebar">
        <h2 style="color:var(--primary-color); margin-bottom: 30px;">üéì EduPlat</h2>
        <nav>
            <a href="dashboard.html" class="nav-link">üè† Dashboard</a>
            <a href="cursos.html" class="nav-link">üìö Mis Cursos</a>
            <a href="apuntes.html" class="nav-link active">üìù Apuntes</a>
            <a href="cerrarsesion.html" class="nav-link" style="margin-top:20px; color:red;">üö™ Salir</a>
        </nav>
    </aside>

    <main class="main-content">
        <header style="display:flex; justify-content:space-between; align-items:center;">
            <h1>Mis Apuntes</h1>
            <div id="user-display" style="display:flex; align-items:center; gap:10px;">
                <span id="u-name">...</span>
                <img id="u-photo" src="" style="width:35px; border-radius:50%;">
            </div>
        </header>

        <div class="notes-container">
            <aside class="folders-sidebar">
                <button class="btn-add-folder" id="new-folder-btn">+ Nueva Carpeta</button>
                <div id="folders-list">
                    <div class="folder-item active" data-name="General">üìÅ General</div>
                </div>
            </aside>

            <section class="editor-area">
                <div class="editor-header">
                    <h2 id="folder-title">Carpeta: General</h2>
                    <span id="save-msg" style="font-size: 0.8em; color: green;"></span>
                    <button class="btn-save" id="save-btn">Guardar</button>
                </div>
                <textarea id="notes-text" placeholder="Escribe tus apuntes aqu√≠..."></textarea>
            </section>
        </div>
    </main>

    <script type="module">
        import { db, auth } from './firebase-config.js';
        import { doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        let currentFolder = "General";

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('u-name').textContent = user.displayName;
                document.getElementById('u-photo').src = user.photoURL;
                loadNotes(user.uid, currentFolder);
            } else { window.location.href = 'login.html'; }
        });

        async function loadNotes(uid, folder) {
            const docSnap = await getDoc(doc(db, "users", uid, "apuntes", folder));
            document.getElementById('notes-text').value = docSnap.exists() ? docSnap.data().contenido : "";
            document.getElementById('folder-title').textContent = `Carpeta: ${folder}`;
        }

        document.getElementById('save-btn').onclick = async () => {
            const user = auth.currentUser;
            if (user) {
                document.getElementById('save-msg').textContent = "Guardando...";
                await setDoc(doc(db, "users", user.uid, "apuntes", currentFolder), {
                    contenido: document.getElementById('notes-text').value,
                    fecha: new Date()
                });
                document.getElementById('save-msg').textContent = "Cerrado y Guardado ‚úÖ";
                setTimeout(() => document.getElementById('save-msg').textContent = "", 2000);
            }
        };

        document.getElementById('new-folder-btn').onclick = () => {
            const name = prompt("Nombre de la carpeta:");
            if (name) {
                const item = document.createElement('div');
                item.className = 'folder-item';
                item.textContent = `üìÅ ${name}`;
                item.onclick = () => {
                    document.querySelectorAll('.folder-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    currentFolder = name;
                    loadNotes(auth.currentUser.uid, name);
                };
                document.getElementById('folders-list').appendChild(item);
            }
        };
    </script>
</body>
</html>