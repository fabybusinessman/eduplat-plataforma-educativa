<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>EduPlat - Mis Apuntes y Carpetas</title>
    <link rel="stylesheet" href="style.css"> <style>
        /* Estilos r√°pidos para la gesti√≥n de carpetas */
        .notes-layout { display: grid; grid-template-columns: 250px 1fr; gap: 20px; margin-top: 20px; }
        .folder-list { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .folder-item { cursor: pointer; padding: 8px; border-radius: 4px; margin-bottom: 5px; }
        .folder-item:hover { background: #eef5ff; }
        .folder-item.active { background: var(--primary-color); color: white; }
        #notes-area { width: 100%; height: 400px; border-radius: 8px; padding: 15px; }
    </style>
</head>
<body>
    <main class="main-content">
        <h1>Gesti√≥n de Apuntes</h1>
        
        <div class="notes-layout">
            <aside class="folder-list">
                <h3>Carpetas</h3>
                <button id="btn-new-folder" style="width: 100%; margin: 10px 0;">+ Nueva Carpeta</button>
                <div id="folders-container">
                    <div class="folder-item active" data-folder="General">üìÅ General</div>
                </div>
            </aside>

            <section class="editor-section">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 id="current-folder-title">Carpeta: General</h2>
                    <button id="btn-save" class="button">Guardar Apuntes</button>
                </div>
                <textarea id="notes-area" placeholder="Escribe aqu√≠ tus apuntes..."></textarea>
                <p id="status-msg"></p>
            </section>
        </div>
    </main>

    <script type="module">
        import { db, auth } from './firebase-config.js';
        import { doc, getDoc, setDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        let currentFolder = "General";
        const notesArea = document.getElementById('notes-area');
        const statusMsg = document.getElementById('status-msg');

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                loadNotes(user.uid, currentFolder);
                // Aqu√≠ podr√≠as cargar la lista de carpetas desde una colecci√≥n 'folders'
            }
        });

        async function loadNotes(uid, folderName) {
            const docRef = doc(db, "users", uid, "apuntes", folderName);
            const docSnap = await getDoc(docRef);
            notesArea.value = docSnap.exists() ? docSnap.data().contenido : "";
            document.getElementById('current-folder-title').textContent = `Carpeta: ${folderName}`;
        }

        document.getElementById('btn-save').addEventListener('click', async () => {
            const user = auth.currentUser;
            if (user) {
                statusMsg.textContent = "Guardando...";
                const docRef = doc(db, "users", user.uid, "apuntes", currentFolder);
                await setDoc(docRef, {
                    contenido: notesArea.value,
                    fecha: new Date()
                });
                statusMsg.textContent = "¬°Guardado con √©xito! ‚úÖ";
            }
        });

        document.getElementById('btn-new-folder').addEventListener('click', () => {
            const name = prompt("Nombre de la nueva carpeta:");
            if (name) {
                const div = document.createElement('div');
                div.className = 'folder-item';
                div.textContent = `üìÅ ${name}`;
                div.onclick = () => {
                    currentFolder = name;
                    loadNotes(auth.currentUser.uid, name);
                };
                document.getElementById('folders-container').appendChild(div);
            }
        });
    </script>
</body>
</html>